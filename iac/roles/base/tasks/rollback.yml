- name: Remove ArgoCD namespace
  kubernetes.core.k8s:
    state: absent
    kind: Namespace
    name: argocd
  ignore_errors: true
  tags: [rollback, argocd]

- name: Uninstall K3s
  shell: |
    /usr/local/bin/k3s-uninstall.sh
  ignore_errors: true
  register: k3s_uninstall
  tags: [rollback, k3s]

- name: Show K3s uninstall output
  debug:
    var: k3s_uninstall.stdout_lines
  tags: [rollback, k3s]

- name: Stop and disable SSH
  service:
    name: ssh
    state: stopped
    enabled: false
  tags: [rollback, ssh]

- name: Remove base packages
  apt:
    name:
      - curl
      - wget
      - git
      - unzip
      - ca-certificates
      - gnupg
      - lsb-release
      - apt-transport-https
    state: absent
  tags: [rollback, packages]
