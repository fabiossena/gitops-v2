- name: Update apt cache and upgrade system
  apt:
    update_cache: yes
    upgrade: dist
  tags: [apt]

- name: Install base packages (including Python)
  apt:
    name:
      - python3
      - python3-apt
      - python3-pip
      - curl
      - wget
      - git
      - unzip
      - ca-certificates
      - gnupg
      - lsb-release
      - openssh-server
      - apt-transport-https
    state: present
  tags: [packages, python]

- name: Ensure SSH enabled and running
  service:
    name: ssh
    enabled: true
    state: started
  tags: [ssh]

- name: Show IP addresses
  command: ip a
  register: ip_output
  changed_when: false
  tags: [ip]

- debug:
    var: ip_output.stdout_lines
  tags: [ip]
